<?xml version="1.0" encoding="UTF-8"?>
<beans:beans xmlns="http://www.springframework.org/schema/security"
             xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
             xmlns:beans="http://www.springframework.org/schema/beans"
             xmlns:security="http://www.springframework.org/schema/security"
             xmlns:bean="http://www.springframework.org/schema/beans"

             xsi:schemaLocation="
                                http://www.springframework.org/schema/beans
                                http://www.springframework.org/schema/beans/spring-beans.xsd
                                http://www.springframework.org/schema/security
                                http://www.springframework.org/schema/security/spring-security-3.1.xsd">

<!--<security:global-method-security secured-annotations="enabled" /> -->


       <security:http auto-config="true" access-denied-page="/access_denied.jsp" >
           <security:intercept-url pattern="/css/**" access="ROLE_ADMIN"/>
           <security:intercept-url pattern='/login.htm*' access="IS_AUTHENTICATED_ANONYMOUSLY"/>
           <security:intercept-url pattern="/login.jsp*" access="IS_AUTHENTICATED_ANONYMOUSLY"/>
           <security:intercept-url pattern="/advertisement/post.htm*" access="ROLE_ADMIN" />
           <security:intercept-url pattern="/advertisement/placing*.*" access="ROLE_USER, ROLE_ADMIN" />
           <security:intercept-url pattern='/advertisement/view*' access='ROLE_USER, ROLE_ADMIN, IS_AUTHENTICATED_ANONYMOUSLY'  />
           <security:intercept-url pattern='/advertisement/list.*' access='ROLE_USER, ROLE_ADMIN, IS_AUTHENTICATED_ANONYMOUSLY'  />
           <security:intercept-url pattern='/advertisement/makeCaptcha.html' access='ROLE_USER, ROLE_ADMIN, IS_AUTHENTICATED_ANONYMOUSLY'  />
           <security:intercept-url pattern="/user/auth*" access="ROLE_USER, ROLE_ADMIN, IS_AUTHENTICATED_ANONYMOUSLY" />
           <security:intercept-url pattern="/user/**" access="ROLE_USER, ROLE_ADMIN, IS_AUTHENTICATED_ANONYMOUSLY" />

           <security:form-login login-page='/login.html'
                                default-target-url='/advertisement/list.html'
                                always-use-default-target='true'
                                authentication-failure-url="/auth_failed.html" />
           <security:logout logout-url="/user/logout.html"/>

           <security:anonymous username="guest"  granted-authority="IS_AUTHENTICATED_ANONYMOUSLY"/>
      </security:http>

<!--
    <security:authentication-manager alias="authenticationManager">
       <security:authentication-provider>
           <security:jdbc-user-service
                        data-source-ref="dataSource"
                              users-by-username-query="SELECT u.email as username, u.password as password, u.enabled as enabled FROM it.sevenbits.entity.User u WHERE u.email = ?"
                        authorities-by-username-query="SELECT u.email as username, u.role as authority                          FROM it.sevenbits.entity.User u WHERE u.email = ?" />
        </security:authentication-provider>

    </security:authentication-manager>
    -->

<!--<security:authentication-manager>
    <security:authentication-provider>
        <security:user-service>
            <security:user name="admin@test.ru" password="pass" authorities="ROLE_ADMIN"/>
            <security:user name="user1@test.ru" password="1111" authorities="ROLE_USER"/>
            <security:user name="user2@test.ru" password="2222" disabled="true" authorities="ROLE_USER"/>
        </security:user-service>
    </security:authentication-provider>
</security:authentication-manager>

-->
    <bean:bean id="myUserDetailsService" class="it.sevenbits.security.MyUserDetailsService">
        <!--name="dataSource" ref="dataSource"/> -->
    </bean:bean>
    <authentication-manager>
        <authentication-provider user-service-ref='myUserDetailsService'>

        </authentication-provider>
    </authentication-manager>


    <!--<security:authentication-manager>
        <security:authentication-provider user-service-ref="myUserDetailsService" >
         <security:password-encoder hash="sha"><security:salt-source user-property="username"/></security:password-encoder>
        </security:authentication-provider>
    </security:authentication-manager>
        -->


</beans:beans>
                